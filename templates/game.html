<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sequence Master Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="game-layout">
        <div class="sidebar">
            <h2>Menu</h2>
            <div class="currency-display">
                <h3>üíé Bytes: <span id="bytes-count">0</span></h3>
                <button id="shop-btn" class="primary-btn" style="width: 100%; margin-top: 0.5em;">üõí Shop</button>
            </div>
            <div>
                <h3>How to Play</h3>
                <ul>
                    <li>Observe the sequence and hint.</li>
                    <li>Enter the missing number before time runs out!</li>
                    <li>Each level is harder and more cryptic.</li>
                </ul>
            </div>
            <div>
                <h3>About</h3>
                <p>This game is designed to challenge your logic and automation skills. Can you master the sequence?</p>
            </div>
            <div>
                <h3>Leaderboard</h3>
                <ol id="leaderboard-list">
                    <li>Loading...</li>
                </ol>
            </div>
            <div id="score-history" class="score-history">
                <h3>Recent Scores <button class="view-all-scores" id="view-all-btn">View All</button></h3>
                <ul id="recent-scores-list">
                    <!-- Recent scores will be populated here -->
                </ul>
            </div>
        </div>
        <div class="game-main">
            <div class="game-card" id="game-card" style="display:none;">
                <h1>Sequence Master V2: <span style="color:#1976d2;">The Cryptic Progression!</span></h1>
                <iframe id="scoreboard-iframe" src="{{ url_for('static', filename='scoreboard.html') }}"
                    class="scoreboard-iframe"></iframe>
                <div id="timer-bar-bg">
                    <div id="timer-bar-fill"></div>
                    <span id="timer-countdown">20</span>
                </div>
                <div class="sequence-display">
                    <div id="level-score"><b>Level 1</b> - <b>Score: 0</b></div>
                    <div id="sequence">Sequence: 2 4 6 8 ?</div>
                </div>
                <div id="hint-message" class="hint-message">Hint will appear here.</div>
                <form class="answer-form" id="answer-form">
                    <input type="text" id="answer-input" placeholder="Enter your answer" autocomplete="off" required>
                    <button type="submit" id="submit-btn">Submit</button>
                </form>
                <div class="power-up-controls" id="power-up-controls">
                    <button class="power-up-btn" id="use-time-freeze" disabled>
                        ‚è±Ô∏è Time Freeze <span class="count">0</span>
                    </button>
                    <button class="power-up-btn" id="use-debugger" disabled>
                        üîç Debugger <span class="count">0</span>
                    </button>
                    <button class="power-up-btn" id="use-skip" disabled>
                        ‚è≠Ô∏è Skip <span class="count">0</span>
                    </button>
                </div>
                <div class="controls" style="margin-top: 10px;">
                    <button type="button" id="quit-btn" onclick="quitGame()">Quit</button>
                    <button id="restart-btn" style="display:none;">Restart Game</button>
                </div>
                <div class="feedback-message" id="feedback-message">Feedback will appear here.</div>
                <iframe id="funfact-iframe" src="{{ url_for('static', filename='funfact.html') }}"
                    class="funfact-iframe"></iframe>
            </div>
            <div id="start-screen"
                style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:60vh;">
                <h1>Welcome to Sequence Master!</h1>
                <div class="game-modes">
                    <h2>Select Game Mode</h2>
                    <div class="mode-grid">
                        <div class="mode-card" data-mode="classic" tabindex="0" role="button">
                            <h3>Classic Mode</h3>
                            <p>Original sequence challenge with 20s timer</p>
                            <div class="mode-stats">
                                <span>Best Score: <span id="classic-best">0</span></span>
                                <span>Games: <span id="classic-games">0</span></span>
                            </div>
                        </div>
                        <div class="mode-card" data-mode="speed" tabindex="0" role="button">
                            <h3>Speed Mode</h3>
                            <p>10s timer but 2x points!</p>
                            <div class="mode-stats">
                                <span>Best Score: <span id="speed-best">0</span></span>
                                <span>Games: <span id="speed-games">0</span></span>
                            </div>
                        </div>
                        <div class="mode-card" data-mode="zen" tabindex="0" role="button">
                            <h3>Zen Mode</h3>
                            <p>No timer, complex patterns</p>
                            <div class="mode-stats">
                                <span>Best Score: <span id="zen-best">0</span></span>
                                <span>Games: <span id="zen-games">0</span></span>
                            </div>
                        </div>
                        <div class="mode-card" data-mode="daily" tabindex="0" role="button">
                            <h3>Daily Challenge</h3>
                            <p>One attempt at today's sequence</p>
                            <div class="mode-stats">
                                <span>Streak: <span id="daily-streak">0</span></span>
                                <span>Completed: <span id="daily-completed">No</span></span>
                            </div>
                        </div>
                        <div class="mode-card" data-mode="code_breaker" tabindex="0" role="button">
                            <h3>üé® Code Breaker</h3>
                            <p>Visual & logic patterns - not just numbers!</p>
                            <div class="mode-stats">
                                <span>Best Score: <span id="code_breaker-best">0</span></span>
                                <span>Games: <span id="code_breaker-games">0</span></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="achievements-preview">
                    <h3>Your Progress</h3>
                    <div class="achievement-icons">
                        <!-- Achievement icons will be dynamically added -->
                    </div>
                    <div class="stats-summary">
                        <span>Total Games: <span id="total-games">0</span></span>
                        <span>Global Rank: <span id="global-rank">--</span></span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="play-btn" style="font-size:1.2em; padding:0.7em 2em; margin-top:2em;" disabled>Select a
                        Mode</button>
                    <button id="tutorial-btn" class="secondary-btn">How to Play</button>
                    <button id="settings-btn" class="secondary-btn">Settings</button>
                    <button id="battle-btn" class="primary-btn" style="margin-top:1em;">Battle Mode</button>
                </div>
            </div>
        </div>
    </div>
    <footer class="game-footer">&copy; 2024 Sequence Master Challenge | Powered by Flask</footer>

    <!-- Username Modal -->
    <div id="username-modal" class="modal">
        <div class="modal-content">
            <h2>Enter your name for the leaderboard:</h2>
            <input type="text" id="username-input" placeholder="Your name or nickname">
            <button id="username-submit">Start</button>
            <p>(Leave blank for a fun random name!)</p>
        </div>
    </div>

    <!-- Score History Modal -->
    <div id="score-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>All Score History</h2>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            <div class="modal-list" id="all-scores-list">
                <!-- All scores will be populated here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>Theme</h3>
                    <div class="theme-selector">
                        <button data-theme="dark" class="active">Dark</button>
                        <button data-theme="light">Light</button>
                        <button data-theme="auto">Auto</button>
                    </div>
                </div>
                <div class="setting-group">
                    <h3>Sound</h3>
                    <label class="switch">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-group">
                    <h3>Notifications</h3>
                    <label class="switch">
                        <input type="checkbox" id="notifications-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-group">
                    <h3>Keyboard Shortcuts</h3>
                    <button id="shortcuts-btn">View Shortcuts</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorial-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>How to Play</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="tutorial-steps">
                <!-- Tutorial content will be dynamically loaded -->
            </div>
            <div class="tutorial-nav">
                <button id="prev-step" disabled>Previous</button>
                <span id="step-indicator">1/5</span>
                <button id="next-step">Next</button>
            </div>
        </div>
    </div>

    <!-- Battle Modal -->
    <div id="battle-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="modal-close" id="close-battle-modal">&times;</span>
            <h2>Battle Mode</h2>
            <p>Choose your opponent:</p>
            <button id="find-player-btn" class="primary-btn">Find Player</button>
            <button id="play-ai-btn" class="secondary-btn">Play vs Computer</button>
            <div id="battle-status" style="margin-top:1em;"></div>
        </div>
    </div>

    <!-- Fun Fact Modal -->
    <div id="funfact-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="modal-close" id="close-funfact-modal">&times;</span>
            <h2>Fun Fact</h2>
            <div id="funfact-content">Loading...</div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div id="shop-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíé Power-Up Shop</h2>
                <button class="modal-close" id="close-shop-modal">&times;</button>
            </div>
            <div class="shop-balance">
                <h3>Your Bytes: <span id="shop-bytes">0</span></h3>
            </div>
            <div class="shop-grid">
                <div class="power-up-card" data-powerup="time_freeze">
                    <div class="power-up-icon">‚è±Ô∏è</div>
                    <h3>Time Freeze</h3>
                    <p>Add 10 seconds to the timer</p>
                    <div class="power-up-footer">
                        <span class="power-up-price">50 Bytes</span>
                        <button class="buy-btn" data-powerup="time_freeze">Buy</button>
                    </div>
                    <div class="power-up-owned">Owned: <span class="owned-count">0</span></div>
                </div>
                <div class="power-up-card" data-powerup="debugger">
                    <div class="power-up-icon">üîç</div>
                    <h3>Debugger</h3>
                    <p>Reveal one digit of the answer</p>
                    <div class="power-up-footer">
                        <span class="power-up-price">75 Bytes</span>
                        <button class="buy-btn" data-powerup="debugger">Buy</button>
                    </div>
                    <div class="power-up-owned">Owned: <span class="owned-count">0</span></div>
                </div>
                <div class="power-up-card" data-powerup="skip">
                    <div class="power-up-icon">‚è≠Ô∏è</div>
                    <h3>Skip</h3>
                    <p>Skip this level without penalty</p>
                    <div class="power-up-footer">
                        <span class="power-up-price">100 Bytes</span>
                        <button class="buy-btn" data-powerup="skip">Buy</button>
                    </div>
                    <div class="power-up-owned">Owned: <span class="owned-count">0</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Boss Battle Overlay -->
    <div id="boss-overlay" class="boss-overlay" style="display:none;">
        <div class="boss-content">
            <div class="boss-header">
                <h1>üî• BOSS BATTLE üî•</h1>
                <div class="boss-level">Level <span id="boss-level-num">5</span></div>
            </div>
            <div class="boss-timer">
                <div class="boss-timer-bar" id="boss-timer-bar"></div>
                <span id="boss-timer-text">30</span>s
            </div>
            <div class="boss-progress">
                <span id="boss-progress-text">0/3</span> Sequences Completed
            </div>
            <div class="boss-sequence-display">
                <div id="boss-sequence"></div>
                <div id="boss-hint" class="boss-hint"></div>
            </div>
            <form id="boss-answer-form" class="boss-answer-form">
                <input type="text" id="boss-answer-input" placeholder="Enter answer" autocomplete="off" required>
                <button type="submit" id="boss-submit-btn">Submit</button>
            </form>
            <div id="boss-feedback" class="boss-feedback"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>